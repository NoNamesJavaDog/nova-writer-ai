# æœ¬åœ°å¯åŠ¨è¯´æ˜

## âš¡ å¿«é€Ÿå¯åŠ¨ï¼ˆ3 æ­¥ï¼‰

### ç¬¬ 1 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰ï¼š
```cmd
copy backend\.env.example backend\.env
copy nova-ai-service\.env.example nova-ai-service\.env
```

2. **ç¼–è¾‘ backend\.env**ï¼Œè®¾ç½®ä»¥ä¸‹å¿…å¡«é¡¹ï¼š
```env
# å¿…å¡« - ä½ çš„ Gemini API Key
GEMINI_API_KEY=ä½ çš„-api-key-æ”¾è¿™é‡Œ

# æ•°æ®åº“é…ç½®ï¼ˆæ ¹æ®ä½ çš„ Docker PostgreSQLï¼‰
DATABASE_URL=postgresql://postgres:ä½ çš„å¯†ç @localhost:5432/novawrite_ai
```

3. **ç¼–è¾‘ nova-ai-service\.env**ï¼Œè®¾ç½®ï¼š
```env
# å¿…å¡« - Gemini API Key
GEMINI_API_KEY=ä½ çš„-api-key-æ”¾è¿™é‡Œ
```

### ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥æ•°æ®åº“

ç¡®ä¿ä½ çš„ Docker PostgreSQL æ­£åœ¨è¿è¡Œï¼š

```cmd
REM æ£€æŸ¥ PostgreSQL å®¹å™¨
docker ps | findstr postgres

REM å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨å®ƒ
docker start <ä½ çš„-postgres-å®¹å™¨å>

REM æˆ–è€…åˆ›å»ºæ–°çš„ PostgreSQL å®¹å™¨ï¼ˆä½¿ç”¨ pgvectorï¼‰
docker run -d ^
  --name nova-ai-db ^
  -e POSTGRES_USER=postgres ^
  -e POSTGRES_PASSWORD=novawrite_db_2024 ^
  -e POSTGRES_DB=novawrite_ai ^
  -p 5432:5432 ^
  pgvector/pgvector:pg16
```

**éªŒè¯æ•°æ®åº“è¿æ¥**ï¼š
```cmd
python scripts\check_db.py
```

### ç¬¬ 3 æ­¥ï¼šä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

```cmd
scripts\start_local.bat
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ã€pgvector æ‰©å±•ï¼‰
- âœ… å¯åŠ¨ AI å¾®æœåŠ¡ï¼ˆ8001 ç«¯å£ï¼‰
- âœ… å¯åŠ¨ä¸»åº”ç”¨åç«¯ï¼ˆ8000 ç«¯å£ï¼‰
- âœ… éªŒè¯æœåŠ¡çŠ¶æ€

---

## ğŸ“¡ è®¿é—®æœåŠ¡

å¯åŠ¨æˆåŠŸåï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **AI å¾®æœåŠ¡** | http://localhost:8001 | çº¯ AI API è°ƒç”¨ |
| **AI æ–‡æ¡£** | http://localhost:8001/docs | Swagger UIï¼ˆ16 ä¸ªç«¯ç‚¹ï¼‰ |
| **ä¸»åº”ç”¨** | http://localhost:8000 | å®Œæ•´ä¸šåŠ¡ API |
| **ä¸»åº”ç”¨æ–‡æ¡£** | http://localhost:8000/docs | Swagger UI |

---

## ğŸ§ª æµ‹è¯• API

### æµ‹è¯• AI å¾®æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8001/health

# ç”Ÿæˆå°è¯´å¤§çº²ï¼ˆç›´æ¥è°ƒç”¨å¾®æœåŠ¡ï¼‰
curl -X POST http://localhost:8001/api/v1/outline/generate-full \
  -H "Content-Type: application/json" \
  -H "X-Provider: gemini" \
  -d "{\"title\":\"æ˜Ÿé™…æ¢é™©\",\"genre\":\"ç§‘å¹»\",\"synopsis\":\"ä¸€ä¸ªå…³äºå¤ªç©ºçš„æ•…äº‹\"}"
```

### æµ‹è¯•ä¸»åº”ç”¨

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æ³¨å†Œç”¨æˆ·
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"test\",\"email\":\"test@example.com\",\"password\":\"Test123456\"}"

# ç™»å½•è·å– token
curl -X POST http://localhost:8000/api/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"test\",\"password\":\"Test123456\"}"
```

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```cmd
REM AI å¾®æœåŠ¡
curl http://localhost:8001/health

REM ä¸»åº”ç”¨
curl http://localhost:8000/health

REM æ•°æ®åº“æ£€æŸ¥
python scripts\check_db.py
```

### åœæ­¢æœåŠ¡

**Windows**ï¼šç›´æ¥å…³é—­å¼¹å‡ºçš„å‘½ä»¤è¡Œçª—å£

**Linux/Mac**ï¼š
```bash
./scripts/stop_local.sh
```

### é‡æ–°åˆå§‹åŒ–æ•°æ®åº“

```cmd
REM åˆ é™¤æ—§æ•°æ®
psql -U postgres -c "DROP DATABASE novawrite_ai;"
psql -U postgres -c "CREATE DATABASE novawrite_ai;"

REM é‡æ–°åˆå§‹åŒ–
python scripts\init_local_db.py
```

### æŸ¥çœ‹æ—¥å¿—

**Windows**ï¼š
- AI å¾®æœåŠ¡æ—¥å¿—ï¼šåœ¨å¼¹å‡ºçš„ "AI Microservice" çª—å£ä¸­æŸ¥çœ‹
- ä¸»åº”ç”¨æ—¥å¿—ï¼šåœ¨å¼¹å‡ºçš„ "Backend" çª—å£ä¸­æŸ¥çœ‹

**Linux/Mac**ï¼š
```bash
tail -f logs/ai-service.log    # AI å¾®æœåŠ¡æ—¥å¿—
tail -f logs/backend.log        # ä¸»åº”ç”¨æ—¥å¿—
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```
é”™è¯¯: [Errno 10048] Only one usage of each socket address...
```

**è§£å†³**ï¼š
```cmd
REM æŸ¥æ‰¾å ç”¨ 8000 ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8000

REM ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢ <PID>ï¼‰
taskkill /F /PID <PID>

REM å¯¹ 8001 ç«¯å£é‡å¤ä¸Šè¿°æ“ä½œ
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```
é”™è¯¯: could not connect to server
```

**è§£å†³**ï¼š
1. æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š`docker ps | findstr postgres`
2. æ£€æŸ¥ `backend\.env` ä¸­çš„ `DATABASE_URL` é…ç½®
3. æµ‹è¯•è¿æ¥ï¼š`python scripts\check_db.py`

### é—®é¢˜ 3ï¼šæ¨¡å—å¯¼å…¥é”™è¯¯

```
é”™è¯¯: ModuleNotFoundError: No module named 'xxx'
```

**è§£å†³**ï¼š
```cmd
REM é‡æ–°å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

cd ..\nova-ai-service
pip install -r requirements.txt
```

### é—®é¢˜ 4ï¼šGemini API åœ°ç†é™åˆ¶

```
é”™è¯¯: location is not supported
```

**è§£å†³**ï¼š
1. é…ç½®ä»£ç†ï¼ˆWARP æˆ–å…¶ä»–ï¼‰
2. åœ¨ä¸¤ä¸ª `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
```env
GEMINI_PROXY=http://127.0.0.1:40000
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
nova-ai/
â”œâ”€â”€ backend/                           # ä¸»åº”ç”¨åç«¯
â”‚   â”œâ”€â”€ .env                          # é…ç½®æ–‡ä»¶ï¼ˆéœ€åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ main.py                       # å…¥å£
â”‚   â”œâ”€â”€ services/ai/
â”‚   â”‚   â”œâ”€â”€ ai_service_client.py     # å¾®æœåŠ¡å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ gemini_service.py        # AI é€‚é…å™¨
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ nova-ai-service/                  # AI å¾®æœåŠ¡
â”‚   â”œâ”€â”€ .env                         # é…ç½®æ–‡ä»¶ï¼ˆéœ€åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py                  # å¾®æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ core/providers/
â”‚   â”‚       â””â”€â”€ gemini.py            # Gemini å®ç°
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ scripts/                          # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ start_local.bat              # Windows å¯åŠ¨è„šæœ¬ â­
â”‚   â”œâ”€â”€ start_local.sh               # Linux/Mac å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ stop_local.sh                # åœæ­¢è„šæœ¬
â”‚   â”œâ”€â”€ init_local_db.py             # æ•°æ®åº“åˆå§‹åŒ– â­
â”‚   â””â”€â”€ check_db.py                  # æ•°æ®åº“æ£€æŸ¥
â”‚
â”œâ”€â”€ docker-compose.yml                # Docker ç¼–æ’
â”œâ”€â”€ START_HERE.md                     # è¯¦ç»†å¯åŠ¨æŒ‡å—
â””â”€â”€ æœ¬åœ°å¯åŠ¨è¯´æ˜.md                    # æœ¬æ–‡ä»¶
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®Œæˆä¸Šè¿° 3 ä¸ªæ­¥éª¤å¯åŠ¨æœåŠ¡
2. è®¿é—® http://localhost:8001/docs æµ‹è¯• AI å¾®æœåŠ¡
3. è®¿é—® http://localhost:8000/docs æµ‹è¯•ä¸»åº”ç”¨
4. å¼€å‘ä½ çš„å‰ç«¯åº”ç”¨æˆ–è°ƒç”¨ API

---

## ğŸ“š æ›´å¤šèµ„æº

- **å®Œæ•´å¯åŠ¨æŒ‡å—**ï¼š[START_HERE.md](START_HERE.md)
- **AI å¾®æœåŠ¡æ¶æ„**ï¼š[AI_MICROSERVICE_SETUP.md](AI_MICROSERVICE_SETUP.md)
- **å¾®æœåŠ¡æ–‡æ¡£**ï¼š[nova-ai-service/README.md](nova-ai-service/README.md)
- **å¿«é€Ÿå¼€å§‹**ï¼š[nova-ai-service/QUICK_START.md](nova-ai-service/QUICK_START.md)

---

## ğŸ’¡ æç¤º

- å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
- ä»£ç ä¿®æ”¹ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ï¼ˆ`--reload` æ¨¡å¼ï¼‰
- æ‰€æœ‰æœåŠ¡åœ¨ç‹¬ç«‹çª—å£è¿è¡Œï¼Œä¾¿äºæŸ¥çœ‹æ—¥å¿—
- å…³é—­çª—å£å³å¯åœæ­¢å¯¹åº”æœåŠ¡

ğŸ‰ **äº«å—å¼€å‘å§ï¼**
